<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ContractHawk // Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/@phosphor-icons/web" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #050505; color: #e0e0e0; font-family: 'JetBrains Mono', monospace; }
        .glass-panel { background: rgba(11, 11, 15, 0.8); border: 1px solid rgba(0, 255, 159, 0.1); }
        .scan-anim { position: absolute; width: 100%; height: 2px; background: #00ff9f; animation: scan 1.5s infinite linear; opacity: 0.8; box-shadow: 0 0 10px #00ff9f; }
        @keyframes scan { 0% { top: 0; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
        .text-neon { text-shadow: 0 0 5px rgba(0, 255, 159, 0.5); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="border-b border-white/10 p-4 flex justify-between items-center bg-black/50 backdrop-blur-md sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <i class="ph-fill ph-shield-check text-[#00ff9f] text-2xl"></i>
            <span class="font-bold text-xl tracking-tight">CONTRACT<span class="text-white">HAWK</span></span>
        </div>
        <div class="flex items-center gap-6 text-xs">
            <span class="text-gray-500">OPERATIVE: <span class="text-white">{{ user }}</span></span>
            <span class="text-green-500 flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> ONLINE</span>
            <a href="/logout" class="text-red-500 hover:text-red-400">[ DISCONNECT ]</a>
        </div>
    </nav>

    <main class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-0">
        
        <div class="p-8 border-r border-white/10 flex flex-col">
            <div class="flex justify-between mb-4">
                <h2 class="text-[#00d4ff] font-bold flex items-center gap-2"><i class="ph ph-file-text"></i> TARGET DATA</h2>
                <button onclick="clearText()" class="text-xs text-gray-500 hover:text-white">[ CLEAR ]</button>
            </div>
            
            <textarea id="contractInput" class="flex-grow bg-[#0b0b0f] border border-gray-800 text-sm p-4 text-gray-300 focus:outline-none focus:border-[#00ff9f] resize-none font-mono" placeholder="// PASTE LEGAL TEXT HERE FOR ANALYSIS..."></textarea>
            
            <button onclick="runScan()" id="scanBtn" class="mt-6 bg-[#00ff9f] hover:bg-white text-black font-bold py-4 transition-all flex items-center justify-center gap-2 tracking-widest uppercase">
                <i class="ph-bold ph-radar"></i> Initiate Neural Scan
            </button>
        </div>

        <div class="p-8 bg-[#08080a] relative overflow-hidden">
            <div id="scannerOverlay" class="hidden absolute inset-0 bg-black/90 z-20 flex flex-col items-center justify-center">
                <div class="text-[#00ff9f] font-bold text-xl mb-2 animate-pulse">NEURAL NETWORK ACTIVE</div>
                <div class="text-xs text-gray-500 font-mono">Decryption in progress...</div>
                <div class="w-64 h-64 border border-[#00ff9f]/30 mt-8 relative overflow-hidden">
                    <div class="scan-anim"></div>
                </div>
            </div>

            <div class="mb-8 border-b border-white/10 pb-4">
                <h2 class="text-[#ff003c] font-bold flex items-center gap-2"><i class="ph ph-warning-octagon"></i> THREAT ASSESSMENT</h2>
            </div>

            <div id="resultsArea" class="hidden animate-pulse">
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="glass-panel p-4">
                        <div class="text-xs text-gray-500 mb-1">RISK INDEX</div>
                        <div id="scoreDisplay" class="text-4xl font-bold text-white">0%</div>
                    </div>
                    <div class="glass-panel p-4">
                        <div class="text-xs text-gray-500 mb-1">VERDICT</div>
                        <div id="verdictDisplay" class="text-2xl font-bold text-[#ff003c]">CRITICAL</div>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="text-xs text-[#00d4ff] mb-2 font-bold">>> EXECUTIVE SUMMARY</div>
                    <p id="summaryText" class="text-sm text-gray-300 leading-relaxed border-l-2 border-[#00d4ff] pl-4">
                        Waiting for data stream...
                    </p>
                </div>

                <div>
                    <div class="text-xs text-[#ff003c] mb-2 font-bold">>> DETECTED ANOMALIES</div>
                    <ul id="redFlagsList" class="space-y-3 text-sm text-gray-400">
                        </ul>
                </div>
            </div>

            <div id="emptyState" class="h-full flex flex-col items-center justify-center text-gray-700 opacity-50">
                <i class="ph ph-cpu text-6xl mb-4"></i>
                <p class="text-xs tracking-widest">SYSTEM IDLE // WAITING FOR INPUT</p>
            </div>

        </div>
    </main>

    <script>
        function clearText() {
            document.getElementById('contractInput').value = "";
        }

        async function runScan() {
            const text = document.getElementById('contractInput').value;
            if (!text) {
                alert("ERROR: NO DATA DETECTED");
                return;
            }

            // 1. UI: Loading State
            document.getElementById('scannerOverlay').classList.remove('hidden');
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('resultsArea').classList.add('hidden');
            document.getElementById('scanBtn').disabled = true;
            document.getElementById('scanBtn').innerText = "PROCESSING...";

            try {
                // 2. API Call
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: text })
                });
                
                const data = await response.json();

                // 3. UI: Reveal Results
                document.getElementById('scannerOverlay').classList.add('hidden');
                document.getElementById('resultsArea').classList.remove('hidden');
                document.getElementById('scanBtn').disabled = false;
                document.getElementById('scanBtn').innerHTML = '<i class="ph-bold ph-radar"></i> Initiate Neural Scan';

                // 4. Fill Data
                const score = data.risk_score;
                const scoreEl = document.getElementById('scoreDisplay');
                scoreEl.innerText = score + "/100";
                
                // Color Coding
                if(score > 75) scoreEl.className = "text-4xl font-bold text-[#ff003c] text-neon";
                else if(score > 40) scoreEl.className = "text-4xl font-bold text-yellow-400";
                else scoreEl.className = "text-4xl font-bold text-[#00ff9f]";

                document.getElementById('verdictDisplay').innerText = data.verdict;
                document.getElementById('summaryText').innerText = data.summary;

                // Fill List
                const list = document.getElementById('redFlagsList');
                list.innerHTML = "";
                data.red_flags.forEach(flag => {
                    const li = document.createElement('li');
                    li.className = "flex items-start gap-2";
                    li.innerHTML = `<i class="ph-fill ph-warning text-[#ff003c] mt-1"></i> <span>${flag}</span>`;
                    list.appendChild(li);
                });

            } catch (err) {
                console.error(err);
                alert("SYSTEM FAILURE: CONNECTION LOST");
                document.getElementById('scannerOverlay').classList.add('hidden');
            }
        }
    </script>
</body>
</html>